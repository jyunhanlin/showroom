"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62],{6723:function(t,e,n){n.d(e,{zx:function(){return T}});var r=n(7375),i=n(2846),o=n(4592),a=n(8554),s=n.n(a),u=n(7294),l=n(6450),c=n(917),d=n(1358);function f(){return(f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var p=["label","thickness","speed","emptyColor","className"],h=(0,c.F4)({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),m=(0,i.Gp)((function(t,e){var n=(0,i.mq)("Spinner",t),r=(0,i.Lr)(t),a=r.label,s=void 0===a?"Loading...":a,l=r.thickness,c=void 0===l?"2px":l,m=r.speed,g=void 0===m?"0.45s":m,v=r.emptyColor,y=void 0===v?"transparent":v,w=r.className,b=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(r,p),S=(0,o.cx)("chakra-spinner",w),x=f({display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:c,borderBottomColor:y,borderLeftColor:y,animation:h+" "+g+" linear infinite"},n);return u.createElement(i.m$.div,f({ref:e,__css:x,className:S},b),s&&u.createElement(d.TX,null,s))}));function g(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}o.Ts&&(m.displayName="Spinner");var y=["size","colorScheme","variant","className","spacing","isAttached","isDisabled"],w=(0,l.kr)({strict:!1,name:"ButtonGroupContext"}),b=w[0],S=w[1],x=(0,i.Gp)((function(t,e){var n=t.size,r=t.colorScheme,a=t.variant,s=t.className,l=t.spacing,c=void 0===l?"0.5rem":l,d=t.isAttached,f=t.isDisabled,p=g(t,y),h=(0,o.cx)("chakra-button__group",s),m=u.useMemo((function(){return{size:n,colorScheme:r,variant:a,isDisabled:f}}),[n,r,a,f]),w={display:"inline-flex"};return w=v({},w,d?{"> *:first-of-type:not(:last-of-type)":{borderEndRadius:0},"> *:not(:first-of-type):not(:last-of-type)":{borderRadius:0},"> *:not(:first-of-type):last-of-type":{borderStartRadius:0}}:{"& > *:not(style) ~ *:not(style)":{marginStart:c}}),u.createElement(b,{value:m},u.createElement(i.m$.div,v({ref:e,role:"group",__css:w,className:h},p)))}));o.Ts&&(x.displayName="ButtonGroup");var E=["label","placement","spacing","children","className","__css"],O=function(t){var e=t.label,n=t.placement;t.spacing;var r=t.children,a=void 0===r?u.createElement(m,{color:"currentColor",width:"1em",height:"1em"}):r,s=t.className,l=t.__css,c=g(t,E),d=(0,o.cx)("chakra-button__spinner",s),f="start"===n?"marginEnd":"marginStart",p=u.useMemo((function(){var t;return v(((t={display:"flex",alignItems:"center",position:e?"relative":"absolute"})[f]=e?"0.5rem":0,t.fontSize="1em",t.lineHeight="normal",t),l)}),[l,e,f]);return u.createElement(i.m$.div,v({className:d},c,{__css:p}),a)};o.Ts&&(O.displayName="ButtonSpinner");var k=["children","className"],M=function(t){var e=t.children,n=t.className,r=g(t,k),a=u.isValidElement(e)?u.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,s=(0,o.cx)("chakra-button__icon",n);return u.createElement(i.m$.span,v({display:"inline-flex",alignSelf:"center",flexShrink:0},r,{className:s}),a)};o.Ts&&(M.displayName="ButtonIcon");var R=["isDisabled","isLoading","isActive","isFullWidth","children","leftIcon","rightIcon","loadingText","iconSpacing","type","spinner","spinnerPlacement","className","as"],T=(0,i.Gp)((function(t,e){var n=S(),a=(0,i.mq)("Button",v({},n,t)),l=(0,i.Lr)(t),c=l.isDisabled,d=void 0===c?null==n?void 0:n.isDisabled:c,f=l.isLoading,p=l.isActive,h=l.isFullWidth,m=l.children,y=l.leftIcon,w=l.rightIcon,b=l.loadingText,x=l.iconSpacing,E=void 0===x?"0.5rem":x,k=l.type,M=l.spinner,T=l.spinnerPlacement,H=void 0===T?"start":T,I=l.className,B=l.as,F=g(l,R),N=u.useMemo((function(){var t,e=s()({},null!=(t=null==a?void 0:a._focus)?t:{},{zIndex:1});return v({display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",width:h?"100%":"auto"},a,!!n&&{_focus:e})}),[a,n,h]),A=function(t){var e=u.useState(!t),n=e[0],r=e[1];return{ref:u.useCallback((function(t){t&&r("BUTTON"===t.tagName)}),[]),type:n?"button":void 0}}(B),D=A.ref,_=A.type,L={rightIcon:w,leftIcon:y,iconSpacing:E,children:m};return u.createElement(i.m$.button,v({disabled:d||f,ref:(0,r.qq)(e,D),as:B,type:null!=k?k:_,"data-active":(0,o.PB)(p),"data-loading":(0,o.PB)(f),__css:N,className:(0,o.cx)("chakra-button",I)},F),f&&"start"===H&&u.createElement(O,{className:"chakra-button__spinner--start",label:b,placement:"start"},M),f?b||u.createElement(i.m$.span,{opacity:0},u.createElement(P,L)):u.createElement(P,L),f&&"end"===H&&u.createElement(O,{className:"chakra-button__spinner--end",label:b,placement:"end"},M))}));function P(t){var e=t.leftIcon,n=t.rightIcon,r=t.children,i=t.iconSpacing;return u.createElement(u.Fragment,null,e&&u.createElement(M,{marginEnd:i},e),r,n&&u.createElement(M,{marginStart:i},n))}o.Ts&&(T.displayName="Button");var H=["icon","children","isRound","aria-label"],I=(0,i.Gp)((function(t,e){var n=t.icon,r=t.children,i=t.isRound,o=t["aria-label"],a=g(t,H),s=n||r,l=u.isValidElement(s)?u.cloneElement(s,{"aria-hidden":!0,focusable:!1}):null;return u.createElement(T,v({padding:"0",borderRadius:i?"full":void 0,ref:e,"aria-label":o},a),l)}));o.Ts&&(I.displayName="IconButton")},1358:function(t,e,n){n.d(e,{TX:function(){return a},NL:function(){return o}});var r=n(2846),i=n(4592),o={border:"0px",clip:"rect(0px, 0px, 0px, 0px)",height:"1px",width:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},a=(0,r.m$)("span",{baseStyle:o});i.Ts&&(a.displayName="VisuallyHidden");var s=(0,r.m$)("input",{baseStyle:o});i.Ts&&(s.displayName="VisuallyHiddenInput")},1247:function(t,e,n){n.d(e,{zD:function(){return yt},oS:function(){return wt}});var r=n(5217),i=n(6537),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function l(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(t){var e=t.shape[2],n=(0,r.argMax)(t,2),i=(0,r.reshape)(n,[-1]);return(0,r.oneHot)(i,e)}function d(t,e){return(0,r.tidy)((function(){return(0,r.cast)((0,r.greater)(t,(0,r.scalar)(e)),"int32")}))}function f(t,e){var n=e.shape,i=n[0],o=n[1],a=n[2];return(0,r.tidy)((function(){var n=c(e),s=(0,r.expandDims)((0,r.range)(0,a,1,"int32"),1),u=(0,r.cast)((0,r.matMul)(n,s),"int32"),l=(0,r.reshape)(u,[i,o]),d=(0,r.add)(l,(0,r.scalar)(1,"int32"));return(0,r.sub)(function(t,e){return(0,r.mul)(t,e)}(d,t),(0,r.scalar)(1,"int32"))}))}function p(t){var e=t.shape,n=e[0],i=e[1],o=e[2];return(0,r.tidy)((function(){var e=c(t),a=(0,r.expandDims)((0,r.range)(0,o,1,"int32"),1),s=(0,r.cast)((0,r.matMul)(e,a),"int32");return(0,r.reshape)(s,[n,i])}))}var h=function(){function t(t,e){this.model=t,this.outputStride=e;var n=this.model.inputs[0].shape;r.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return t.prototype.predict=function(t){var e=this;return(0,r.tidy)((function(){var n=e.preprocessInput((0,r.cast)(t,"float32")),i=(0,r.expandDims)(n,0),o=e.model.predict(i).map((function(t){return(0,r.squeeze)(t,[0])})),a=e.nameOutputResults(o);return{heatmapScores:(0,r.sigmoid)(a.heatmap),offsets:a.offsets,displacementFwd:a.displacementFwd,displacementBwd:a.displacementBwd,segmentation:a.segmentation,partHeatmaps:a.partHeatmaps,longOffsets:a.longOffsets,partOffsets:a.partOffsets}}))},t.prototype.dispose=function(){this.model.dispose()},t}(),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.preprocessInput=function(t){return(0,r.tidy)((function(){return(0,r.sub)((0,r.div)(t,127.5),1)}))},e.prototype.nameOutputResults=function(t){return{offsets:t[0],segmentation:t[1],partHeatmaps:t[2],longOffsets:t[3],heatmap:t[4],displacementFwd:t[5],displacementBwd:t[6],partOffsets:t[7]}},e}(h),g=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],v=g.length,y=g.reduce((function(t,e,n){return t[e]=n,t}),{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(t){var e=t[0],n=t[1];return[y[e],y[n]]}));function w(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1],s=n.top,u=n.bottom;return[a/(n.left+n.right+i),o/(s+u+r)]}function b(t,e,n,r){return{y:r.get(t,e,n),x:r.get(t,e,n+v)}}function S(t,e,n){var r=b(t.heatmapY,t.heatmapX,t.id,n),i=r.y,o=r.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+i}}function x(t,e,n){return t<e?e:t>n?n:t}function E(t,e){return{x:t.x+e.x,y:t.y+e.y}}function O(t,e,n){void 0===n&&(n=.3);for(var r=0,i=0,o=0;o<t.length;o++)e.keypoints[o].score>n&&(i+=1,r+=Math.pow(t[o].x-e.keypoints[o].position.x,2)+Math.pow(t[o].y-e.keypoints[o].position.y,2));return 0===i?r=1/0:r/=i,r}function k(t,e,n,r,i,o,a){for(var s=a[0],u=a[1],l=n(t),c=l.y*r+l.x,d=i[v*(2*c)+e],f=i[v*(2*c+1)+e],p=t.y+d,h=t.x+f,m=0;m<o;m++){p=Math.min(p,s-1);var g=n({x:h=Math.min(h,u-1),y:p}),y=g.y*r+g.x;p+=d=i[v*(2*y)+e],h+=f=i[v*(2*y+1)+e]}return{x:h,y:p}}function M(t,e,n,r,i,o,a,s,u,l){for(var c=i[0],d=i[1],f=o[0],p=o[1],h=s[0],m=s[1],g=[],v=function(t){return function(t,e,n,r){var i=e[0],o=e[1],a=n[0],s=n[1],u=Math.round(((i+t.y+1)*s-1)/r);return{x:Math.round(((o+t.x+1)*a-1)/r),y:u}}(t,[c,d],[f,p],u)},y=0;y<r;y++){var w=k(t,y,v,a,e,l,[h,m]);g.push(w)}for(var b=-1,S=1/0,x=0;x<n.length;x++){var E=O(g,n[x]);E<S&&(b=x,S=E)}return b}function R(t,e){var n=t[0],r=t[1];return[Math.round((r-1)/e+1),Math.round((n-1)/e+1)]}function T(t,e,n,i,o,a,s,u,l,c,d){for(var f=s[0],p=s[1],h=t.shape,m=h[0],g=h[1],y=e.shape.slice(0,2),b=y[0],S=y[1],x=(0,r.reshape)(e,[b,S,2,v]),E=new Float32Array(d*v*3).fill(0),O=0;O<n.length;O++)for(var k=O*v*3,M=n[O],R=0;R<v;R++){var T=M.keypoints[R],P=k+3*R;E[P]=T.score,E[P+1]=T.position.y,E[P+2]=T.position.x}var H=w([i,o],[f,p],u),I=H[0],B=H[1],F=(0,r.tensor)(E,[d,v,3]),N=u.top,A=u.left,D={variableNames:["segmentation","longOffsets","poses"],outputShape:[m,g],userCode:"\n    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {\n      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));\n    }\n\n    float convertToPositionInOutputFloat(\n        int pos, int pad, float scale, int stride) {\n      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);\n    }\n\n    float dist(float x1, float y1, float x2, float y2) {\n      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);\n    }\n\n    float sampleLongOffsets(float h, float w, int d, int k) {\n      float fh = fract(h);\n      float fw = fract(w);\n      int clH = int(ceil(h));\n      int clW = int(ceil(w));\n      int flH = int(floor(h));\n      int flW = int(floor(w));\n      float o11 = getLongOffsets(flH, flW, d, k);\n      float o12 = getLongOffsets(flH, clW, d, k);\n      float o21 = getLongOffsets(clH, flW, d, k);\n      float o22 = getLongOffsets(clH, clW, d, k);\n      float o1 = mix(o11, o12, fw);\n      float o2 = mix(o21, o22, fw);\n      return mix(o1, o2, fh);\n    }\n\n    int findNearestPose(int h, int w) {\n      float prob = getSegmentation(h, w);\n      if (prob < 1.0) {\n        return -1;\n      }\n\n      // Done(Tyler): convert from output space h/w to strided space.\n      float stridedH = convertToPositionInOutputFloat(\n        h, "+N+", "+B+", "+a+");\n      float stridedW = convertToPositionInOutputFloat(\n        w, "+A+", "+I+", "+a+");\n\n      float minDist = 1000000.0;\n      int iMin = -1;\n      for (int i = 0; i < "+d+"; i++) {\n        float curDistSum = 0.0;\n        int numKpt = 0;\n        for (int k = 0; k < "+v+"; k++) {\n          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);\n          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);\n\n          float y = float(h) + dy;\n          float x = float(w) + dx;\n\n          for (int s = 0; s < "+l+"; s++) {\n            int yRounded = round(min(y, float("+(i-1)+")));\n            int xRounded = round(min(x, float("+(o-1)+")));\n\n            float yStrided = convertToPositionInOutputFloat(\n              yRounded, "+N+", "+B+", "+a+");\n            float xStrided = convertToPositionInOutputFloat(\n              xRounded, "+A+", "+I+", "+a+");\n\n            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);\n            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);\n\n            y = y + dy;\n            x = x + dx;\n          }\n\n          float poseScore = getPoses(i, k, 0);\n          float poseY = getPoses(i, k, 1);\n          float poseX = getPoses(i, k, 2);\n          if (poseScore > "+c+") {\n            numKpt = numKpt + 1;\n            curDistSum = curDistSum + dist(x, y, poseX, poseY);\n          }\n        }\n        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {\n          minDist = curDistSum / float(numKpt);\n          iMin = i;\n        }\n      }\n      return iMin;\n    }\n\n    void main() {\n        ivec2 coords = getOutputCoords();\n        int nearestPose = findNearestPose(coords[0], coords[1]);\n        setOutput(float(nearestPose));\n      }\n  "};return(0,r.backend)().compileAndRun(D,[t,x,F])}function P(){return"webgl"===(0,r.getBackend)()}function H(t,e,n,i,o,a,s,c,d,f,p,h){var m=s[0],g=s[1];return void 0===d&&(d=.2),void 0===f&&(f=8),void 0===p&&(p=.3),void 0===h&&(h=10),u(this,void 0,void 0,(function(){var s,u,v,y,b;return l(this,(function(l){switch(l.label){case 0:return s=n.filter((function(t){return t.score>=d})),P()?(v=(0,r.tidy)((function(){var n=T(t,e,s,i,o,a,[m,g],c,f,p,h),u=(0,r.engine)().makeTensorFromDataId(n.dataId,n.shape,n.dtype);return s.map((function(t,e){return function(t,e){return(0,r.tidy)((function(){return(0,r.cast)((0,r.equal)(t,(0,r.scalar)(e)),"int32")}))}(u,e)}))})),[4,Promise.all(v.map((function(t){return t.data()})))]):[3,2];case 1:return u=l.sent(),v.forEach((function(t){return t.dispose()})),[3,5];case 2:return[4,t.data()];case 3:return y=l.sent(),[4,e.data()];case 4:b=l.sent(),u=function(t,e,n,r,i,o,a,s,u,l){var c=a[0],d=a[1];void 0===l&&(l=5);for(var f=n.map((function(t){return new Uint8Array(r*i).fill(0)})),p=s.top,h=s.left,m=w([r,i],[c,d],s),g=m[0],v=m[1],y=R([c,d],o)[0],b=0;b<r;b+=1)for(var S=0;S<i;S+=1){var x=b*i+S;if(1===t[x]){var E=M({x:S,y:b},e,n,l,[p,h],[g,v],y,[r,i],o,u);E>=0&&(f[E][x]=1)}}return f}(y,b,s,i,o,a,[m,g],c,f),l.label=5;case 5:return[2,u.map((function(t,e){return{data:t,pose:s[e],width:o,height:i}}))]}}))}))}function I(t,e,n,i,o,a,s,c,d,f,p,h,m){var g=c[0],v=c[1];return void 0===f&&(f=.2),void 0===p&&(p=8),void 0===h&&(h=.3),void 0===m&&(m=10),u(this,void 0,void 0,(function(){var u,c,y,b,S,x;return l(this,(function(l){switch(l.label){case 0:return u=i.filter((function(t){return t.score>=f})),P()?(y=(0,r.tidy)((function(){var i=T(t,e,u,o,a,s,[g,v],d,p,h,m),l=(0,r.engine)().makeTensorFromDataId(i.dataId,i.shape,i.dtype);return u.map((function(t,e){return function(t,e,n){return(0,r.tidy)((function(){return(0,r.sub)((0,r.mul)((0,r.cast)((0,r.equal)(t,(0,r.scalar)(n)),"int32"),(0,r.add)(e,1)),1)}))}(l,n,e)}))})),[4,Promise.all(y.map((function(t){return t.data()})))]):[3,2];case 1:return c=l.sent(),y.forEach((function(t){return t.dispose()})),[3,6];case 2:return[4,t.data()];case 3:return b=l.sent(),[4,e.data()];case 4:return S=l.sent(),[4,n.data()];case 5:x=l.sent(),c=function(t,e,n,r,i,o,a,s,u,l,c){var d=s[0],f=s[1];void 0===c&&(c=5);for(var p=r.map((function(t){return new Int32Array(i*o).fill(-1)})),h=u.top,m=u.left,g=w([i,o],[d,f],u),v=g[0],y=g[1],b=R([d,f],a)[0],S=0;S<i;S+=1)for(var x=0;x<o;x+=1){var E=S*o+x;if(1===t[E]){var O=M({x:x,y:S},e,r,c,[h,m],[v,y],b,[i,o],a,l);O>=0&&(p[O][E]=n[E])}}return p}(b,S,x,u,o,a,s,[g,v],d,p),l.label=6;case 6:return[2,c.map((function(t,e){return{pose:u[e],data:t,height:o,width:a}}))]}}))}))}function B(t){return Math.floor(t/2)}var F=function(){function t(t,e){this.priorityQueue=new Array(t),this.numberOfElements=-1,this.getElementValue=e}return t.prototype.enqueue=function(t){this.priorityQueue[++this.numberOfElements]=t,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var t=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,t},t.prototype.empty=function(){return-1===this.numberOfElements},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(t){for(;t>0&&this.less(B(t),t);)this.exchange(t,B(t)),t=B(t)},t.prototype.sink=function(t){for(;2*t<=this.numberOfElements;){var e=2*t;if(e<this.numberOfElements&&this.less(e,e+1)&&e++,!this.less(t,e))break;this.exchange(t,e),t=e}},t.prototype.getValueAt=function(t){return this.getElementValue(this.priorityQueue[t])},t.prototype.less=function(t,e){return this.getValueAt(t)<this.getValueAt(e)},t.prototype.exchange=function(t,e){var n=this.priorityQueue[t];this.priorityQueue[t]=this.priorityQueue[e],this.priorityQueue[e]=n},t}();function N(t,e,n,r,i,o){for(var a=o.shape,s=a[0],u=a[1],l=!0,c=Math.max(n-i,0),d=Math.min(n+i+1,s),f=c;f<d;++f){for(var p=Math.max(r-i,0),h=Math.min(r+i+1,u),m=p;m<h;++m)if(o.get(f,m,t)>e){l=!1;break}if(!l)break}return l}var A=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(t){var e=t[0],n=t[1];return[y[e],y[n]]})),D=A.map((function(t){return t[1]})),_=A.map((function(t){return t[0]}));function L(t,e,n,r){return{y:x(Math.round(t.y/e),0,n-1),x:x(Math.round(t.x/e),0,r-1)}}function q(t,e,n,r,i,o,a,s){void 0===s&&(s=2);for(var u=r.shape,l=u[0],c=u[1],d=function(t,e,n){var r=n.shape[2]/2;return{y:n.get(e.y,e.x,t),x:n.get(e.y,e.x,r+t)}}(t,L(e.position,o,l,c),a),f=E(e.position,d),p=0;p<s;p++){var h=L(f,o,l,c),m=b(h.y,h.x,n,i);f=E({x:h.x*o,y:h.y*o},{x:m.x,y:m.y})}var v=L(f,o,l,c),y=r.get(v.y,v.x,n);return{position:f,part:g[n],score:y}}function W(t,e,n,r,i,o){var a=e.shape[2],s=D.length,u=new Array(a),l=t.part,c=t.score,d=S(l,r,n);u[l.id]={score:c,part:g[l.id],position:d};for(var f=s-1;f>=0;--f){var p=D[f],h=_[f];u[p]&&!u[h]&&(u[h]=q(f,u[p],h,e,n,r,o))}for(f=0;f<s;++f)p=_[f],h=D[f],u[p]&&!u[h]&&(u[h]=q(f,u[p],h,e,n,r,i));return u}function z(t,e,n,r){var i=n.x,o=n.y;return t.some((function(t){var n=t.keypoints[r].position;return function(t,e,n,r){var i=n-t,o=r-e;return i*i+o*o}(o,i,n.y,n.x)<=e}))}function j(t,e,n){return n.reduce((function(n,r,i){var o=r.position,a=r.score;return z(t,e,o,i)||(n+=a),n}),0)/n.length}function C(t,e,n,r,i,o,a,s){void 0===a&&(a=.5),void 0===s&&(s=20);for(var u=[],l=function(t,e,n){for(var r=n.shape,i=r[0],o=r[1],a=r[2],s=new F(i*o*a,(function(t){return t.score})),u=0;u<i;++u)for(var l=0;l<o;++l)for(var c=0;c<a;++c){var d=n.get(u,l,c);d<t||N(c,d,u,l,e,n)&&s.enqueue({score:d,part:{heatmapY:u,heatmapX:l,id:c}})}return s}(a,1,t),c=s*s;u.length<o&&!l.empty();){var d=l.dequeue();if(!z(u,c,S(d.part,i,e),d.part.id)){var f=W(d,t,e,i,n,r),p=j(u,c,f);u.push({keypoints:f,score:p})}}return u}var K,V=[-123.15,-115.9,-103.06],Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.preprocessInput=function(t){return(0,r.add)(t,V)},e.prototype.nameOutputResults=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5];return{offsets:o,segmentation:t[6],partHeatmaps:a,longOffsets:i,heatmap:r,displacementFwd:n,displacementBwd:e,partOffsets:t[7]}},e}(h),$="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",G="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function X(t){if("undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)return function(t){if("offsetHeight"in t&&0!==t.offsetHeight&&"offsetWidth"in t&&0!==t.offsetWidth)return[t.offsetHeight,t.offsetWidth];if(null!=t.height&&null!=t.width)return[t.height,t.width];throw new Error("HTMLImageElement must have height and width attributes set.")}(t);if("undefined"!=typeof ImageData&&t instanceof ImageData)return[t.height,t.width];if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)return function(t){return t.hasAttribute("height")&&t.hasAttribute("width")?[t.height,t.width]:[t.videoHeight,t.videoWidth]}(t);if(t instanceof r.Tensor)return[t.shape[0],t.shape[1]];throw new Error("error: Unknown input type: "+t+".")}function Y(t,e){return function(t,e){return(t-1)%e==0}(t,e)?t:Math.floor(t/e)*e+1}var U={low:"low",medium:"medium",high:"high",full:"full"},J=((K={})[U.low]=.25,K[U.medium]=.5,K[U.high]=.75,K[U.full]=1,K);function Z(t,e,n){var i=n[0],o=n[1],a=function(t){if("string"==typeof t){var e=J[t];return r.util.assert("number"==typeof e,(function(){return"string value of inputResolution must be one of "+Object.values(U).join(",")+" but was "+t+"."})),e}return r.util.assert("number"==typeof t&&t<=2&&t>=.1,(function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+t})),t}(t);return[Y(i*a,e),Y(o*a,e)]}function tt(t,e,n,i,o){var a=e[0],s=e[1],u=n[0],l=n[1],c=i[0],d=c[0],f=c[1],p=i[1],h=p[0],m=p[1];return void 0===o&&(o=!1),(0,r.tidy)((function(){var e=r.image.resizeBilinear(t,[u,l],!0);return o&&(e=(0,r.sigmoid)(e)),function(t,e,n){var i=e[0],o=e[1],a=n[0],s=a[0],u=a[1],l=n[1],c=l[0],d=l[1];return(0,r.tidy)((function(){var e=(0,r.expandDims)(t);return(0,r.squeeze)(r.image.cropAndResize(e,[[s/(i+s+u-1),c/(o+c+d-1),(s+i-1)/(i+s+u-1),(c+o-1)/(o+c+d-1)]],[0],[i,o]),[0])}))}(e,[a,s],[[d,f],[h,m]])}))}function et(t,e){var n=e[0],i=e[1],o=X(t),a=o[0],s=o[1],u=i/n,l=[0,0,0,0],c=l[0],d=l[1],f=l[2],p=l[3];return s/a<u?(c=0,d=0,f=Math.round(.5*(u*a-s)),p=Math.round(.5*(u*a-s))):(c=Math.round(.5*(1/u*s-a)),d=Math.round(.5*(1/u*s-a)),f=0,p=0),{resized:(0,r.tidy)((function(){var e=function(t){return t instanceof r.Tensor?t:r.browser.fromPixels(t)}(t);return e=(0,r.pad3d)(e,[[c,d],[f,p],[0,0]]),r.image.resizeBilinear(e,[n,i])})),padding:{top:c,left:f,right:p,bottom:d}}}function nt(t){return u(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Promise.all(t.map((function(t){return t.buffer()})))]}))}))}function rt(t,e,n,r,i){var o=e[0],a=e[1],s=n[0],u=n[1],l=function(t,e,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),1===n&&1===e&&0===r&&0===i?t:t.map((function(t){return function(t,e,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),{score:t.score,keypoints:t.keypoints.map((function(t){var o=t.score,a=t.part,s=t.position;return{score:o,part:a,position:{x:s.x*n+i,y:s.y*e+r}}}))}}(t,e,n,r,i)}))}(t,(o+r.top+r.bottom)/s,(a+r.left+r.right)/u,-r.top,-r.left);return i?function(t,e){return e<=0?t:t.map((function(t){return function(t,e){return{score:t.score,keypoints:t.keypoints.map((function(t){var n=t.score,r=t.part,i=t.position;return{score:n,part:r,position:{x:e-1-i.x,y:i.y}}}))}}(t,e)}))}(l,a):l}var it=!0,ot=!1,at={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},st=["MobileNetV1","ResNet50"],ut={MobileNetV1:[8,16,32],ResNet50:[32,16]},lt={MobileNetV1:[.5,.75,1],ResNet50:[1]},ct=[1,2,4];var dt={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},ft={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function pt(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,i=t.nmsRadius;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".")}function ht(t){var e=t.segmentationThreshold,n=t.maxDetections,r=t.scoreThreshold,i=t.nmsRadius,o=t.minKeypointScore,a=t.refineSteps;if(e<0||e>1)throw new Error("segmentationThreshold "+e+". Should be in range [0.0, 1.0]");if(n<=0)throw new Error("Invalid maxDetections "+n+". Should be > 0");if(r<0||r>1)throw new Error("Invalid scoreThreshold "+r+". Should be in range [0.0, 1.0]");if(i<=0)throw new Error("Invalid nmsRadius "+i+".");if(o<0||o>1)throw new Error("Invalid minKeypointScore "+o+".Should be in range [0.0, 1.0]");if(a<=0||a>20)throw new Error("Invalid refineSteps "+a+".Should be in range [1, 20]")}var mt=function(){function t(t){this.baseModel=t}return t.prototype.predictForPersonSegmentation=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForPersonSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,partHeatmapLogits:e.partHeatmaps,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd}},t.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(t){var e=this.baseModel.predict(t);return{segmentLogits:e.segmentation,longOffsets:e.longOffsets,heatmapScores:e.heatmapScores,offsets:e.offsets,displacementFwd:e.displacementFwd,displacementBwd:e.displacementBwd,partHeatmaps:e.partHeatmaps}},t.prototype.segmentPersonActivation=function(t,e,n){var i=this;void 0===n&&(n=.5);var o=X(t),a=o[0],s=o[1],u=Z(e,this.baseModel.outputStride,[a,s]),l=et(t,u),c=l.resized,f=l.padding,p=(0,r.tidy)((function(){var t=i.predictForPersonSegmentation(c),e=t.segmentLogits,o=t.heatmapScores,u=t.offsets,l=t.displacementFwd,p=t.displacementBwd,h=c.shape,m=h[0],g=h[1],v=tt(e,[a,s],[m,g],[[f.top,f.bottom],[f.left,f.right]],it);return{segmentation:d((0,r.squeeze)(v),n),heatmapScores:o,offsets:u,displacementFwd:l,displacementBwd:p}})),h=p.segmentation,m=p.heatmapScores,g=p.offsets,v=p.displacementFwd,y=p.displacementBwd;return c.dispose(),{segmentation:h,heatmapScores:m,offsets:g,displacementFwd:v,displacementBwd:y,padding:f,internalResolutionHeightAndWidth:u}},t.prototype.segmentPerson=function(t,e){return void 0===e&&(e=dt),u(this,void 0,void 0,(function(){var n,r,i,o,a,u,c,d,f,p,h,m,g,v,y,w,b,S;return l(this,(function(l){switch(l.label){case 0:return pt(e=s(s({},dt),e)),n=this.segmentPersonActivation(t,e.internalResolution,e.segmentationThreshold),r=n.segmentation,i=n.heatmapScores,o=n.offsets,a=n.displacementFwd,u=n.displacementBwd,c=n.padding,d=n.internalResolutionHeightAndWidth,f=r.shape,p=f[0],h=f[1],[4,r.data()];case 1:return m=l.sent(),r.dispose(),[4,nt([i,o,a,u])];case 2:return g=l.sent(),v=g[0],y=g[1],w=g[2],b=g[3],S=rt(S=C(v,y,w,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],d,c,ot),i.dispose(),o.dispose(),a.dispose(),u.dispose(),[2,{height:p,width:h,data:m,allPoses:S}]}}))}))},t.prototype.segmentMultiPerson=function(t,e){return void 0===e&&(e=ft),u(this,void 0,void 0,(function(){var n,i,o,a,u,c,f,p,h,m,g,v,y,w,b,S,x,E,O,k,M,R=this;return l(this,(function(l){switch(l.label){case 0:return ht(e=s(s({},ft),e)),n=X(t),i=n[0],o=n[1],a=Z(e.internalResolution,this.baseModel.outputStride,[i,o]),u=et(t,a),c=u.resized,f=u.padding,p=(0,r.tidy)((function(){var t,n=R.predictForMultiPersonInstanceSegmentationAndPart(c),s=n.segmentLogits,u=n.longOffsets,l=n.heatmapScores,p=n.offsets,h=n.displacementFwd,m=n.displacementBwd,g=tt(s,[i,o],a,[[f.top,f.bottom],[f.left,f.right]],it);return t=u,{segmentation:d((0,r.squeeze)(g),e.segmentationThreshold),longOffsets:t,heatmapScoresRaw:l,offsetsRaw:p,displacementFwdRaw:h,displacementBwdRaw:m}})),h=p.segmentation,m=p.longOffsets,g=p.heatmapScoresRaw,v=p.offsetsRaw,y=p.displacementFwdRaw,w=p.displacementBwdRaw,[4,nt([g,v,y,w])];case 1:return b=l.sent(),S=b[0],x=b[1],E=b[2],O=b[3],k=rt(k=C(S,x,E,O,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[i,o],a,f,ot),[4,H(h,m,k,i,o,this.baseModel.outputStride,a,f,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return M=l.sent(),c.dispose(),h.dispose(),m.dispose(),g.dispose(),v.dispose(),y.dispose(),w.dispose(),[2,M]}}))}))},t.prototype.segmentPersonPartsActivation=function(t,e,n){var i=this;void 0===n&&(n=.5);var o=X(t),a=o[0],s=o[1],u=Z(e,this.baseModel.outputStride,[a,s]),l=et(t,u),c=l.resized,p=l.padding,h=(0,r.tidy)((function(){var t=i.predictForPersonSegmentationAndPart(c),e=t.segmentLogits,o=t.partHeatmapLogits,u=t.heatmapScores,l=t.offsets,h=t.displacementFwd,m=t.displacementBwd,g=c.shape,v=g[0],y=g[1],w=tt(e,[a,s],[v,y],[[p.top,p.bottom],[p.left,p.right]],it),b=tt(o,[a,s],[v,y],[[p.top,p.bottom],[p.left,p.right]],it);return{partSegmentation:f(d((0,r.squeeze)(w),n),b),heatmapScores:u,offsets:l,displacementFwd:h,displacementBwd:m}})),m=h.partSegmentation,g=h.heatmapScores,v=h.offsets,y=h.displacementFwd,w=h.displacementBwd;return c.dispose(),{partSegmentation:m,heatmapScores:g,offsets:v,displacementFwd:y,displacementBwd:w,padding:p,internalResolutionHeightAndWidth:u}},t.prototype.segmentPersonParts=function(t,e){return void 0===e&&(e=dt),u(this,void 0,void 0,(function(){var n,r,i,o,a,u,c,d,f,p,h,m,g,v,y,w,b,S;return l(this,(function(l){switch(l.label){case 0:return pt(e=s(s({},dt),e)),n=this.segmentPersonPartsActivation(t,e.internalResolution,e.segmentationThreshold),r=n.partSegmentation,i=n.heatmapScores,o=n.offsets,a=n.displacementFwd,u=n.displacementBwd,c=n.padding,d=n.internalResolutionHeightAndWidth,f=r.shape,p=f[0],h=f[1],[4,r.data()];case 1:return m=l.sent(),r.dispose(),[4,nt([i,o,a,u])];case 2:return g=l.sent(),v=g[0],y=g[1],w=g[2],b=g[3],S=rt(S=C(v,y,w,b,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[p,h],d,c,ot),i.dispose(),o.dispose(),a.dispose(),u.dispose(),[2,{height:p,width:h,data:m,allPoses:S}]}}))}))},t.prototype.segmentMultiPersonParts=function(t,e){return void 0===e&&(e=ft),u(this,void 0,void 0,(function(){var n,i,o,a,u,c,f,h,m,g,v,y,w,b,S,x,E,O,k,M,R,T,P=this;return l(this,(function(l){switch(l.label){case 0:return ht(e=s(s({},ft),e)),n=X(t),i=n[0],o=n[1],a=Z(e.internalResolution,this.baseModel.outputStride,[i,o]),u=et(t,a),c=u.resized,f=u.padding,h=(0,r.tidy)((function(){var t=P.predictForMultiPersonInstanceSegmentationAndPart(c),n=t.segmentLogits,s=t.longOffsets,u=t.heatmapScores,l=t.offsets,h=t.displacementFwd,m=t.displacementBwd,g=t.partHeatmaps,v=tt(n,[i,o],a,[[f.top,f.bottom],[f.left,f.right]],it),y=tt(g,[i,o],a,[[f.top,f.bottom],[f.left,f.right]],it),w=s;return{segmentation:d((0,r.squeeze)(v),e.segmentationThreshold),longOffsets:w,heatmapScoresRaw:u,offsetsRaw:l,displacementFwdRaw:h,displacementBwdRaw:m,partSegmentation:p(y)}})),m=h.segmentation,g=h.longOffsets,v=h.heatmapScoresRaw,y=h.offsetsRaw,w=h.displacementFwdRaw,b=h.displacementBwdRaw,S=h.partSegmentation,[4,nt([v,y,w,b])];case 1:return x=l.sent(),E=x[0],O=x[1],k=x[2],M=x[3],R=rt(R=C(E,O,k,M,this.baseModel.outputStride,e.maxDetections,e.scoreThreshold,e.nmsRadius),[i,o],a,f,ot),[4,I(m,g,S,R,i,o,this.baseModel.outputStride,a,f,e.scoreThreshold,e.refineSteps,e.minKeypointScore,e.maxDetections)];case 2:return T=l.sent(),c.dispose(),m.dispose(),g.dispose(),v.dispose(),y.dispose(),w.dispose(),b.dispose(),S.dispose(),[2,T]}}))}))},t.prototype.dispose=function(){this.baseModel.dispose()},t}();function gt(t){return u(this,void 0,void 0,(function(){var e,n,o,a,s,u;return l(this,(function(l){switch(l.label){case 0:if(e=t.outputStride,n=t.quantBytes,o=t.multiplier,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return a=function(t,e,n){var r={1:"100",.75:"075",.5:"050"},i="model-stride"+t+".json";return 4===n?G+"float/"+r[e]+"/"+i:G+"quant"+n+"/"+r[e]+"/"+i}(e,o,n),[4,(0,i.YL)(t.modelUrl||a)];case 1:return s=l.sent(),u=new m(s,e),[2,new mt(u)]}}))}))}function vt(t){return u(this,void 0,void 0,(function(){var e,n,o,a,s;return l(this,(function(u){switch(u.label){case 0:if(e=t.outputStride,n=t.quantBytes,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return o=function(t,e){var n="model-stride"+t+".json";return 4===e?$+"float/"+n:$+"quant"+e+"/"+n}(e,n),[4,(0,i.YL)(t.modelUrl||o)];case 1:return a=u.sent(),s=new Q(a,e),[2,new mt(s)]}}))}))}function yt(t){return void 0===t&&(t=at),u(this,void 0,void 0,(function(){return l(this,(function(e){return"ResNet50"===(t=function(t){if(null==(t=t||at).architecture&&(t.architecture="MobileNetV1"),st.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+st);if(null==t.outputStride&&(t.outputStride=16),ut[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+ut[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),lt[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+lt[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),ct.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+ct+" for architecture "+t.architecture+".");return t}(t)).architecture?[2,vt(t)]:"MobileNetV1"===t.architecture?[2,gt(t)]:[2,null]}))}))}function wt(t,e,n,r,i){if(void 0===e&&(e={r:0,g:0,b:0,a:0}),void 0===n&&(n={r:0,g:0,b:0,a:255}),void 0===r&&(r=!1),void 0===i&&(i=[1]),Array.isArray(t)&&0===t.length)return null;var o,a=(o=Array.isArray(t)?t:[t])[0],s=a.width,u=a.height,l=new Uint8ClampedArray(s*u*4);function c(t,e,n,r,i,o){void 0===o&&(o={r:0,g:255,b:255,a:255});for(var a=-i;a<=i;a++)for(var s=-i;s<=i;s++)if(0!==a&&0!==s){var u=(e+a)*r+(n+s);t[4*u+0]=o.r,t[4*u+1]=o.g,t[4*u+2]=o.b,t[4*u+3]=o.a}}function d(t,e,n,r,i,o){void 0===i&&(i=[1]),void 0===o&&(o=1);for(var a=0,s=-o;s<=o;s++)for(var u=function(o){if(0!==s&&0!==o){var u=(e+s)*r+(n+o);i.some((function(e){return e===t[u]}))||(a+=1)}},l=-o;l<=o;l++)u(l);return a>0}for(var f=0;f<u;f+=1)for(var p=function(t){var a=f*s+t;l[4*a+0]=n.r,l[4*a+1]=n.g,l[4*a+2]=n.b,l[4*a+3]=n.a;for(var p=function(n){if(i.some((function(t){return t===o[n].data[a]}))){l[4*a]=e.r,l[4*a+1]=e.g,l[4*a+2]=e.b,l[4*a+3]=e.a;var p=d(o[n].data,f,t,s,i);r&&f-1>=0&&f+1<u&&t-1>=0&&t+1<s&&p&&c(l,f,t,s,1)}},h=0;h<o.length;h++)p(h)},h=0;h<s;h+=1)p(h);return new ImageData(l,s,u)}}}]);